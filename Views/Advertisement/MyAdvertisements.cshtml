@model List<StudentFreelance.ViewModels.AdvertisementViewModel>

@{
    ViewData["Title"] = "Quảng Cáo Của Tôi";
}

<link rel="stylesheet" href="~/css/AdvertisementManage.css" />

<div class="topbar">
    <h1><i class="fas fa-ad"></i> Quảng Cáo Của Tôi</h1>
    <div class="filter-row">
        <div class="filter-group">
            <a asp-action="Create" class="btn-primary" style="display: inline-block; text-decoration: none;">
                <i class="fas fa-plus me-2"></i> Tạo Quảng Cáo Mới
            </a>
        </div>
    </div>
</div>

<div class="table-container">
    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success">
            @TempData["Success"]
        </div>
    }

    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger">
            @TempData["Error"]
        </div>
    }

    @if (Model.Count == 0)
    {
        <div class="no-data">
            <p>Bạn chưa có quảng cáo nào. Hãy bắt đầu tạo quảng cáo để hiển thị trên trang chủ!</p>
        </div>
    }
    else
    {
        <table class="styled-table">
            <thead>
                <tr>
                    <th>Hình ảnh</th>
                    <th>Gói</th>
                    <th>Trạng thái</th>
                    <th>Ngày bắt đầu</th>
                    <th>Ngày kết thúc</th>
                    <th>Thao tác</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var ad in Model)
                {
                    <tr>
                        <td>
                            <img src="~/uploads/advertisements/@ad.ImagePath" alt="Advertisement" class="ad-image" style="width: 100px; height: 60px;" />
                        </td>
                        <td>
                            @if (ad.PackageTypeID == 2)
                            {
                                <span class="package-type package-premium">Gói Nổi Bật</span>
                            }
                            else
                            {
                                <span class="package-type package-basic">Gói Cơ Bản</span>
                            }
                        </td>
                        <td>
                            @if (ad.StatusID == 2)
                            {
                                if (ad.EndDate < DateTime.Now)
                                {
                                    <span class="status-expired">Đã hết hạn</span>
                                }
                                else if (!ad.IsActive)
                                {
                                    <span class="status-rejected">Đã hủy</span>
                                }
                                else
                                {
                                    <span class="status-approved">Đang hiển thị</span>
                                }
                            }
                            else if (ad.StatusID == 1)
                            {
                                <span class="status-pending">Đang chờ duyệt</span>
                            }
                            else if (ad.StatusID == 3)
                            {
                                <span class="status-rejected">Bị từ chối</span>
                            }
                            else if (ad.StatusID == 4)
                            {
                                <span class="status-expired">Đã hết hạn</span>
                            }
                        </td>
                        <td>@(ad.StartDate.ToString("dd/MM/yyyy"))</td>
                        <td>@(ad.EndDate.ToString("dd/MM/yyyy"))</td>
                        <td>
                            @if (ad.StatusID == 1)
                            {
                                <a asp-action="Edit" asp-route-id="@ad.Id" class="action-btn edit">
                                    <i class="fas fa-edit"></i> Chỉnh sửa
                                </a>
                            }
                            @if ((ad.EndDate < DateTime.Now || (ad.StatusID == 2 && ad.IsActive)) && ad.StatusID != 1)
                            {
                                <a href="#" class="action-btn renew" onclick="confirmRenew(@ad.Id); return false;">
                                    <i class="fas fa-sync"></i> Gia hạn
                                </a>
                            }
                            @if ((ad.IsActive || ad.StatusID != 2) && ad.StatusID != 3)
                            {
                                <a asp-action="Delete" asp-route-id="@ad.Id" class="action-btn delete">
                                    <i class="fas fa-trash"></i> Xóa
                                </a>
                            }
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    }
</div>

<div class="row mt-5">
    <div class="col-md-6">
        <div class="ad-card">
            <div class="ad-card-header">
                <h5>Thông Tin Gói Quảng Cáo</h5>
            </div>
            <div class="ad-card-body">
                <div class="mb-3">
                    <h6>Gói Cơ Bản</h6>
                    <ul>
                        <li>Hiển thị 1 ảnh trong trình chiếu ở vị trí bất kỳ</li>
                        <li>Thời gian hiển thị: 7 ngày</li>
                        <li>Giá: 100.000đ</li>
                    </ul>
                </div>
                <div>
                    <h6>Gói Nổi Bật</h6>
                    <ul>
                        <li>Hiển thị ảnh ở vị trí nổi bật (hình đầu tiên khi trang tải)</li>
                        <li>Thời gian hiển thị: 7 ngày</li>
                        <li>Giá: 200.000đ</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="ad-card">
            <div class="ad-card-header">
                <h5>Lưu Ý Quan Trọng</h5>
            </div>
            <div class="ad-card-body">
                <ul>
                    <li>Quảng cáo cần được phê duyệt trước khi hiển thị trên trang chủ</li>
                    <li>Mỗi doanh nghiệp chỉ được hiển thị 1 quảng cáo tại một thời điểm</li>
                    <li>Quảng cáo sẽ tự động ẩn sau khi hết hạn</li>
                    <li>Quảng cáo được cập nhật gần nhất sẽ được ưu tiên hiển thị</li>
                    <li>Bạn có thể gia hạn quảng cáo đã hết hạn thêm 7 ngày với cùng mức giá</li>
                </ul>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function confirmRenew(id) {
            if (confirm("Bạn có chắc chắn muốn gia hạn quảng cáo này không?")) {
                window.location.href = '@Url.Action("Renew")/' + id;
            }
        }
    </script>
}
