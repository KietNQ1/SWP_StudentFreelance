@model IEnumerable<StudentFreelance.ViewModels.UserVerificationViewModel>

@{
    Layout = "~/Views/Shared/_Dashboard.cshtml";
    ViewData["Title"] = "User Verification";
    var currentStatus = ViewData["StatusFilter"]?.ToString() ?? "";
    var currentRole = ViewData["RoleFilter"]?.ToString() ?? "";
    var searchString = ViewData["CurrentFilter"]?.ToString() ?? "";
}

<link rel="stylesheet" href="~/css/UserVerification.css" />

<div class="container-fluid">
    <div class="topbar">
        <h1><i class="fas fa-user-shield"></i> Freelancer Management</h1>
        
        <form asp-action="Index" method="get" id="filterForm" class="filter-row">
            <div class="filter-group">
                <input type="text" name="searchString" placeholder="ðŸ” Search freelancer..." value="@searchString" />
            </div>
            
            <div class="filter-group">
                <select name="roleFilter" class="custom-select">
                    <option value="">ðŸ‘¤ All Roles</option>
                    @if (currentRole == "student")
                    {
                        <option value="student" selected>Student</option>
                    }
                    else
                    {
                        <option value="student">Student</option>
                    }
                    
                    @if (currentRole == "business")
                    {
                        <option value="business" selected>Business</option>
                    }
                    else
                    {
                        <option value="business">Business</option>
                    }
                    
                    @if (currentRole == "admin")
                    {
                        <option value="admin" selected>Admin</option>
                    }
                    else
                    {
                        <option value="admin">Admin</option>
                    }
                    
                    @if (currentRole == "moderator")
                    {
                        <option value="moderator" selected>Moderator</option>
                    }
                    else
                    {
                        <option value="moderator">Moderator</option>
                    }
                </select>
            </div>
            
            <div class="filter-group">
                <select name="statusFilter" class="custom-select">
                    <option value="">ðŸ“Š All Statuses</option>
                    @if (currentStatus == "active")
                    {
                        <option value="active" selected>Active</option>
                    }
                    else
                    {
                        <option value="active">Active</option>
                    }
                    
                    @if (currentStatus == "inactive")
                    {
                        <option value="inactive" selected>Inactive</option>
                    }
                    else
                    {
                        <option value="inactive">Inactive</option>
                    }
                    
                    @if (currentStatus == "verified")
                    {
                        <option value="verified" selected>Verified</option>
                    }
                    else
                    {
                        <option value="verified">Verified</option>
                    }
                    
                    @if (currentStatus == "flagged")
                    {
                        <option value="flagged" selected>Flagged</option>
                    }
                    else
                    {
                        <option value="flagged">Flagged</option>
                    }
                </select>
            </div>
            
            <button type="submit" class="filter-btn">
                <i class="fas fa-filter"></i> Filter
            </button>
        </form>
    </div>
    
    <div class="table-container">
        <table class="styled-table" id="freelancersTable">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Full Name</th>
                    <th>Verified</th>
                    <th>Email</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @{
                    int counter = ((int)ViewData["CurrentPage"] - 1) * 10 + 1;
                }
                @foreach (var item in Model)
                {
                    <tr class="transaction-row">
                        <td>@counter</td>
                        <td>
                            <div class="user-info">
                                @item.FullName
                            </div>
                        </td>
                        <td>
                            @if (item.IsVerified)
                            {
                                <div class="verified-badge" style="background-color: #4299e1;">
                                    <i class="fas fa-check-circle" style="color: white !important;"></i>
                                    <span style="color: white !important; font-weight: bold;">Verified</span>
                                </div>
                            }
                        </td>
                        <td>@item.Email</td>
                        <td>
                            @if (item.IsActive)
                            {
                                <span class="status-active">Active</span>
                            }
                            else
                            {
                                <span class="status-inactive">Inactive</span>
                            }
                            
                            @if (item.IsFlagged)
                            {
                                <div class="status-flagged">Flagged</div>
                            }
                        </td>
                        <td class="action-cell">
                            <div class="action-buttons">
                                <a asp-action="Details" asp-route-id="@item.UserID" class="action-btn edit">
                                    <i class="fas fa-edit"></i> Edit
                                </a>
                                <button type="button" class="action-btn delete" onclick="confirmDelete(@item.UserID)">
                                    <i class="fas fa-trash-alt"></i> Delete
                                </button>
                            </div>
                        </td>
                    </tr>
                    counter++;
                }
            </tbody>
        </table>
    </div>
    
    <!-- Pagination -->
    @{
        int totalPages = (int)ViewData["TotalPages"];
        int currentPage = (int)ViewData["CurrentPage"];
        int totalRecords = (int)ViewData["TotalRecords"];
    }
    
    @if (totalPages > 1)
    {
        <div class="pagination-container">
            <div class="pagination-info">
                Showing @(((currentPage - 1) * 10) + 1) to @(Math.Min(currentPage * 10, totalRecords)) of @totalRecords entries
            </div>
            
            <div class="pagination">
                @if (currentPage > 1)
                {
                    <a asp-action="Index" 
                       asp-route-pageNumber="1"
                       asp-route-searchString="@ViewData["CurrentFilter"]"
                       asp-route-roleFilter="@ViewData["RoleFilter"]"
                       asp-route-statusFilter="@ViewData["StatusFilter"]"
                       class="pagination-btn">
                        <i class="fas fa-angle-double-left"></i>
                    </a>
                    
                    <a asp-action="Index" 
                       asp-route-pageNumber="@(currentPage - 1)"
                       asp-route-searchString="@ViewData["CurrentFilter"]"
                       asp-route-roleFilter="@ViewData["RoleFilter"]"
                       asp-route-statusFilter="@ViewData["StatusFilter"]"
                       class="pagination-btn">
                        <i class="fas fa-angle-left"></i>
                    </a>
                }
                
                @{
                    int startPage = Math.Max(1, currentPage - 2);
                    int endPage = Math.Min(totalPages, currentPage + 2);
                    
                    if (startPage > 1)
                    {
                        <span class="pagination-ellipsis">...</span>
                    }
                }
                
                @for (int i = startPage; i <= endPage; i++)
                {
                    <a asp-action="Index" 
                       asp-route-pageNumber="@i"
                       asp-route-searchString="@ViewData["CurrentFilter"]"
                       asp-route-roleFilter="@ViewData["RoleFilter"]"
                       asp-route-statusFilter="@ViewData["StatusFilter"]"
                       class="pagination-btn @(i == currentPage ? "active" : "")">
                        @i
                    </a>
                }
                
                @{
                    if (endPage < totalPages)
                    {
                        <span class="pagination-ellipsis">...</span>
                    }
                }
                
                @if (currentPage < totalPages)
                {
                    <a asp-action="Index" 
                       asp-route-pageNumber="@(currentPage + 1)"
                       asp-route-searchString="@ViewData["CurrentFilter"]"
                       asp-route-roleFilter="@ViewData["RoleFilter"]"
                       asp-route-statusFilter="@ViewData["StatusFilter"]"
                       class="pagination-btn">
                        <i class="fas fa-angle-right"></i>
                    </a>
                    
                    <a asp-action="Index" 
                       asp-route-pageNumber="@totalPages"
                       asp-route-searchString="@ViewData["CurrentFilter"]"
                       asp-route-roleFilter="@ViewData["RoleFilter"]"
                       asp-route-statusFilter="@ViewData["StatusFilter"]"
                       class="pagination-btn">
                        <i class="fas fa-angle-double-right"></i>
                    </a>
                }
            </div>
        </div>
    }
</div>

<!-- ThÃªm Font Awesome náº¿u chÆ°a cÃ³ -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

<script>
    function confirmDelete(userId) {
        if (confirm("Are you sure you want to delete this user?")) {
            window.location.href = "@Url.Action("Delete")" + "/" + userId;
        }
    }
</script> 