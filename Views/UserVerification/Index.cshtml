@model IEnumerable<StudentFreelance.ViewModels.UserVerificationViewModel>

@{
    Layout = "~/Views/Shared/_Dashboard.cshtml";
    ViewData["Title"] = "Qu·∫£n l√Ω x√°c th·ª±c ng∆∞·ªùi d√πng";
    var currentStatus = ViewData["StatusFilter"]?.ToString() ?? "";
    var currentRole = ViewData["RoleFilter"]?.ToString() ?? "";
    var searchString = ViewData["CurrentFilter"]?.ToString() ?? "";
}

<link rel="stylesheet" href="~/css/UserVerification.css" />

<div class="container-fluid">
    <div class="topbar">
        <h1><i class="fas fa-user-shield"></i> Qu·∫£n l√Ω x√°c th·ª±c ng∆∞·ªùi d√πng</h1>

        <form asp-action="Index" method="get" id="filterForm" class="filter-row">
            <div class="filter-group">
                <input type="text" name="searchString" placeholder="üîç T√¨m ki·∫øm ng∆∞·ªùi d√πng..." value="@searchString" />
            </div>

            <div class="filter-group">
                <select name="roleFilter" class="custom-select">
                    <option value="">üë§ T·∫•t c·∫£ vai tr√≤</option>
                    @if (currentRole == "student")
                    {
                        <option value="student" selected>Sinh vi√™n</option>
                    }
                    else
                    {
                        <option value="student">Sinh vi√™n</option>
                    }

                    @if (currentRole == "business")
                    {
                        <option value="business" selected>Doanh nghi·ªáp</option>
                    }
                    else
                    {
                        <option value="business">Doanh nghi·ªáp</option>
                    }

                    @if (currentRole == "admin")
                    {
                        <option value="admin" selected>Qu·∫£n tr·ªã vi√™n</option>
                    }
                    else
                    {
                        <option value="admin">Qu·∫£n tr·ªã vi√™n</option>
                    }

                    @if (currentRole == "moderator")
                    {
                        <option value="moderator" selected>ƒêi·ªÅu ph·ªëi vi√™n</option>
                    }
                    else
                    {
                        <option value="moderator">ƒêi·ªÅu ph·ªëi vi√™n</option>
                    }
                </select>
            </div>

            <div class="filter-group">
                <select name="statusFilter" class="custom-select">
                    <option value="">üìä T·∫•t c·∫£ tr·∫°ng th√°i</option>
                    @if (currentStatus == "active")
                    {
                        <option value="active" selected>ƒêang ho·∫°t ƒë·ªông</option>
                    }
                    else
                    {
                        <option value="active">ƒêang ho·∫°t ƒë·ªông</option>
                    }

                    @if (currentStatus == "inactive")
                    {
                        <option value="inactive" selected>ƒê√£ kh√≥a</option>
                    }
                    else
                    {
                        <option value="inactive">ƒê√£ kh√≥a</option>
                    }

                    @if (currentStatus == "verified")
                    {
                        <option value="verified" selected>ƒê√£ x√°c th·ª±c</option>
                    }
                    else
                    {
                        <option value="verified">ƒê√£ x√°c th·ª±c</option>
                    }

                    @if (currentStatus == "flagged")
                    {
                        <option value="flagged" selected>ƒê√£ b√°o c√°o</option>
                    }
                    else
                    {
                        <option value="flagged">ƒê√£ b√°o c√°o</option>
                    }
                </select>
            </div>

            <button type="submit" class="filter-btn">
                <i class="fas fa-filter"></i> L·ªçc
            </button>
        </form>
    </div>

    <div class="table-container">
        <table class="styled-table" id="freelancersTable">
            <thead>
                <tr>
                    <th>#</th>
                    <th>H·ªç v√† t√™n</th>
                    <th>X√°c th·ª±c</th>
                    <th>Email</th>
                    <th>Tr·∫°ng th√°i</th>
                    <th>Thao t√°c</th>
                </tr>
            </thead>
            <tbody>
                @{
                    int counter = ((int)ViewData["CurrentPage"] - 1) * 10 + 1;
                }
                @foreach (var item in Model)
                {
                    <tr class="transaction-row">
                        <td>@counter</td>
                        <td>
                            <div class="user-info">
                                @item.FullName
                            </div>
                        </td>
                        <td>
                            @if (item.IsVerified)
                            {
                                <div class="verified-badge" style="background-color: #4299e1;">
                                    <i class="fas fa-check-circle" style="color: white !important;"></i>
                                    <span style="color: white !important; font-weight: bold;">ƒê√£ x√°c th·ª±c</span>
                                </div>
                            }
                        </td>
                        <td>@item.Email</td>
                        <td>
                            @if (item.IsActive)
                            {
                                <span class="status-active">ƒêang ho·∫°t ƒë·ªông</span>
                            }
                            else
                            {
                                <span class="status-inactive">ƒê√£ kh√≥a</span>
                            }

                            @if (item.IsFlagged)
                            {
                                <div class="status-flagged">ƒê√£ b√°o c√°o</div>
                            }
                        </td>
                        <td class="action-cell">
                            <div class="action-buttons">
                                <a asp-action="Details" asp-route-id="@item.UserID" class="action-btn edit">
                                    <i class="fas fa-edit"></i> Chi ti·∫øt
                                </a>
                                <button type="button" class="action-btn delete" onclick="confirmDelete(@item.UserID)">
                                    <i class="fas fa-trash-alt"></i> X√≥a
                                </button>
                            </div>
                        </td>
                    </tr>
                    counter++;
                }
            </tbody>
        </table>
    </div>

    <!-- Pagination -->
    @{
        int totalPages = (int)ViewData["TotalPages"];
        int currentPage = (int)ViewData["CurrentPage"];
        int totalRecords = (int)ViewData["TotalRecords"];
    }

    @if (totalPages > 1)
    {
        <div class="pagination-container">
            <div class="pagination-info">
                Hi·ªÉn th·ªã @(((currentPage - 1) * 10) + 1) ƒë·∫øn @(Math.Min(currentPage * 10, totalRecords)) tr√™n t·ªïng @totalRecords b·∫£n ghi
            </div>

            <div class="pagination">
                @if (currentPage > 1)
                {
                    <a asp-action="Index"
                       asp-route-pageNumber="1"
                       asp-route-searchString="@ViewData["CurrentFilter"]"
                       asp-route-roleFilter="@ViewData["RoleFilter"]"
                       asp-route-statusFilter="@ViewData["StatusFilter"]"
                       class="pagination-btn">
                        <i class="fas fa-angle-double-left"></i>
                    </a>

                    <a asp-action="Index"
                       asp-route-pageNumber="@(currentPage - 1)"
                       asp-route-searchString="@ViewData["CurrentFilter"]"
                       asp-route-roleFilter="@ViewData["RoleFilter"]"
                       asp-route-statusFilter="@ViewData["StatusFilter"]"
                       class="pagination-btn">
                        <i class="fas fa-angle-left"></i>
                    </a>
                }

                @{
                    int startPage = Math.Max(1, currentPage - 2);
                    int endPage = Math.Min(totalPages, currentPage + 2);

                    if (startPage > 1)
                    {
                        <span class="pagination-ellipsis">...</span>
                    }
                }

                @for (int i = startPage; i <= endPage; i++)
                {
                    <a asp-action="Index"
                       asp-route-pageNumber="@i"
                       asp-route-searchString="@ViewData["CurrentFilter"]"
                       asp-route-roleFilter="@ViewData["RoleFilter"]"
                       asp-route-statusFilter="@ViewData["StatusFilter"]"
                       class="pagination-btn @(i == currentPage ? "active" : "")">
                        @i
                    </a>
                }

                @{
                    if (endPage < totalPages)
                    {
                        <span class="pagination-ellipsis">...</span>
                    }
                }

                @if (currentPage < totalPages)
                {
                    <a asp-action="Index"
                       asp-route-pageNumber="@(currentPage + 1)"
                       asp-route-searchString="@ViewData["CurrentFilter"]"
                       asp-route-roleFilter="@ViewData["RoleFilter"]"
                       asp-route-statusFilter="@ViewData["StatusFilter"]"
                       class="pagination-btn">
                        <i class="fas fa-angle-right"></i>
                    </a>

                    <a asp-action="Index"
                       asp-route-pageNumber="@totalPages"
                       asp-route-searchString="@ViewData["CurrentFilter"]"
                       asp-route-roleFilter="@ViewData["RoleFilter"]"
                       asp-route-statusFilter="@ViewData["StatusFilter"]"
                       class="pagination-btn">
                        <i class="fas fa-angle-double-right"></i>
                    </a>
                }
            </div>
        </div>
    }
</div>

<!-- Th√™m Font Awesome n·∫øu ch∆∞a c√≥ -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

<script>
    function confirmDelete(userId) {
        if (confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a ng∆∞·ªùi d√πng n√†y kh√¥ng?")) {
            window.location.href = "@Url.Action("Delete")" + "/" + userId;
        }
    }
</script>
